{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.retryAsPromised = exports.TimeoutError = void 0;\n\nclass TimeoutError extends Error {\n  constructor(message, previousError) {\n    super(message);\n    this.name = \"TimeoutError\";\n    this.previous = previousError;\n  }\n\n}\n\nexports.TimeoutError = TimeoutError;\n\nfunction matches(match, err) {\n  if (typeof match === 'function') {\n    try {\n      if (err instanceof match) return true;\n    } catch (_) {\n      return !!match(err);\n    }\n  }\n\n  if (match === err.toString()) return true;\n  if (match === err.message) return true;\n  return match instanceof RegExp && (match.test(err.message) || match.test(err.toString()));\n}\n\nfunction retryAsPromised(callback, optionsInput) {\n  if (!callback || !optionsInput) {\n    throw new Error('retry-as-promised must be passed a callback and a options set');\n  }\n\n  optionsInput = typeof optionsInput === \"number\" ? {\n    max: optionsInput\n  } : optionsInput;\n  const options = {\n    $current: \"$current\" in optionsInput ? optionsInput.$current : 1,\n    max: optionsInput.max,\n    timeout: optionsInput.timeout || undefined,\n    match: optionsInput.match ? Array.isArray(optionsInput.match) ? optionsInput.match : [optionsInput.match] : [],\n    backoffBase: optionsInput.backoffBase === undefined ? 100 : optionsInput.backoffBase,\n    backoffExponent: optionsInput.backoffExponent || 1.1,\n    report: optionsInput.report,\n    name: optionsInput.name || callback.name || 'unknown'\n  };\n  if (options.match && !Array.isArray(options.match)) options.match = [options.match];\n  if (options.report) options.report('Trying ' + options.name + ' #' + options.$current + ' at ' + new Date().toLocaleTimeString(), options);\n  return new Promise(function (resolve, reject) {\n    let timeout;\n    let backoffTimeout;\n    let lastError;\n\n    if (options.timeout) {\n      timeout = setTimeout(function () {\n        if (backoffTimeout) clearTimeout(backoffTimeout);\n        reject(new TimeoutError(options.name + ' timed out', lastError));\n      }, options.timeout);\n    }\n\n    Promise.resolve(callback({\n      current: options.$current\n    })).then(resolve).then(function () {\n      if (timeout) clearTimeout(timeout);\n      if (backoffTimeout) clearTimeout(backoffTimeout);\n    }).catch(function (err) {\n      if (timeout) clearTimeout(timeout);\n      if (backoffTimeout) clearTimeout(backoffTimeout);\n      lastError = err;\n      if (options.report) options.report(err && err.toString() || err, options, err); // Should not retry if max has been reached\n\n      var shouldRetry = options.$current < options.max;\n      if (!shouldRetry) return reject(err);\n      shouldRetry = options.match.length === 0 || options.match.some(function (match) {\n        return matches(match, err);\n      });\n      if (!shouldRetry) return reject(err);\n      var retryDelay = options.backoffBase * Math.pow(options.backoffExponent, options.$current - 1); // Do some accounting\n\n      options.$current++;\n      if (options.report) options.report(`Retrying ${options.name} (${options.$current})`, options);\n\n      if (retryDelay) {\n        // Use backoff function to ease retry rate\n        if (options.report) options.report(`Delaying retry of ${options.name} by ${retryDelay}`, options);\n        backoffTimeout = setTimeout(function () {\n          retryAsPromised(callback, options).then(resolve).catch(reject);\n        }, retryDelay);\n      } else {\n        retryAsPromised(callback, options).then(resolve).catch(reject);\n      }\n    });\n  });\n}\n\nexports.retryAsPromised = retryAsPromised;\n;\nexports.default = retryAsPromised;","map":{"version":3,"names":["Object","defineProperty","exports","value","retryAsPromised","TimeoutError","Error","constructor","message","previousError","name","previous","matches","match","err","_","toString","RegExp","test","callback","optionsInput","max","options","$current","timeout","undefined","Array","isArray","backoffBase","backoffExponent","report","Date","toLocaleTimeString","Promise","resolve","reject","backoffTimeout","lastError","setTimeout","clearTimeout","current","then","catch","shouldRetry","length","some","retryDelay","Math","pow","default"],"sources":["/Users/aurele/node_modules/retry-as-promised/dist/index.js"],"sourcesContent":["'use strict';\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.retryAsPromised = exports.TimeoutError = void 0;\nclass TimeoutError extends Error {\n    constructor(message, previousError) {\n        super(message);\n        this.name = \"TimeoutError\";\n        this.previous = previousError;\n    }\n}\nexports.TimeoutError = TimeoutError;\nfunction matches(match, err) {\n    if (typeof match === 'function') {\n        try {\n            if (err instanceof match)\n                return true;\n        }\n        catch (_) {\n            return !!match(err);\n        }\n    }\n    if (match === err.toString())\n        return true;\n    if (match === err.message)\n        return true;\n    return match instanceof RegExp\n        && (match.test(err.message) || match.test(err.toString()));\n}\nfunction retryAsPromised(callback, optionsInput) {\n    if (!callback || !optionsInput) {\n        throw new Error('retry-as-promised must be passed a callback and a options set');\n    }\n    optionsInput = (typeof optionsInput === \"number\" ? { max: optionsInput } : optionsInput);\n    const options = {\n        $current: \"$current\" in optionsInput ? optionsInput.$current : 1,\n        max: optionsInput.max,\n        timeout: optionsInput.timeout || undefined,\n        match: optionsInput.match ? Array.isArray(optionsInput.match) ? optionsInput.match : [optionsInput.match] : [],\n        backoffBase: optionsInput.backoffBase === undefined ? 100 : optionsInput.backoffBase,\n        backoffExponent: optionsInput.backoffExponent || 1.1,\n        report: optionsInput.report,\n        name: optionsInput.name || callback.name || 'unknown'\n    };\n    if (options.match && !Array.isArray(options.match))\n        options.match = [options.match];\n    if (options.report)\n        options.report('Trying ' + options.name + ' #' + options.$current + ' at ' + new Date().toLocaleTimeString(), options);\n    return new Promise(function (resolve, reject) {\n        let timeout;\n        let backoffTimeout;\n        let lastError;\n        if (options.timeout) {\n            timeout = setTimeout(function () {\n                if (backoffTimeout)\n                    clearTimeout(backoffTimeout);\n                reject(new TimeoutError(options.name + ' timed out', lastError));\n            }, options.timeout);\n        }\n        Promise.resolve(callback({ current: options.$current }))\n            .then(resolve)\n            .then(function () {\n            if (timeout)\n                clearTimeout(timeout);\n            if (backoffTimeout)\n                clearTimeout(backoffTimeout);\n        })\n            .catch(function (err) {\n            if (timeout)\n                clearTimeout(timeout);\n            if (backoffTimeout)\n                clearTimeout(backoffTimeout);\n            lastError = err;\n            if (options.report)\n                options.report((err && err.toString()) || err, options, err);\n            // Should not retry if max has been reached\n            var shouldRetry = options.$current < options.max;\n            if (!shouldRetry)\n                return reject(err);\n            shouldRetry = options.match.length === 0 || options.match.some(function (match) {\n                return matches(match, err);\n            });\n            if (!shouldRetry)\n                return reject(err);\n            var retryDelay = options.backoffBase * Math.pow(options.backoffExponent, options.$current - 1);\n            // Do some accounting\n            options.$current++;\n            if (options.report)\n                options.report(`Retrying ${options.name} (${options.$current})`, options);\n            if (retryDelay) {\n                // Use backoff function to ease retry rate\n                if (options.report)\n                    options.report(`Delaying retry of ${options.name} by ${retryDelay}`, options);\n                backoffTimeout = setTimeout(function () {\n                    retryAsPromised(callback, options)\n                        .then(resolve)\n                        .catch(reject);\n                }, retryDelay);\n            }\n            else {\n                retryAsPromised(callback, options)\n                    .then(resolve)\n                    .catch(reject);\n            }\n        });\n    });\n}\nexports.retryAsPromised = retryAsPromised;\n;\nexports.default = retryAsPromised;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}