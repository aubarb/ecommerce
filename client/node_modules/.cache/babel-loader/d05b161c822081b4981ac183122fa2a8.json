{"ast":null,"code":"'use strict';\n\nmodule.exports = exports = publish;\nexports.usage = 'Publishes pre-built binary (requires aws-sdk)';\n\nconst fs = require('fs');\n\nconst path = require('path');\n\nconst log = require('npmlog');\n\nconst versioning = require('./util/versioning.js');\n\nconst napi = require('./util/napi.js');\n\nconst s3_setup = require('./util/s3_setup.js');\n\nconst existsAsync = fs.exists || path.exists;\n\nconst url = require('url');\n\nfunction publish(gyp, argv, callback) {\n  const package_json = gyp.package_json;\n  const napi_build_version = napi.get_napi_build_version_from_command_args(argv);\n  const opts = versioning.evaluate(package_json, gyp.opts, napi_build_version);\n  const tarball = opts.staged_tarball;\n  existsAsync(tarball, found => {\n    if (!found) {\n      return callback(new Error('Cannot publish because ' + tarball + ' missing: run `node-pre-gyp package` first'));\n    }\n\n    log.info('publish', 'Detecting s3 credentials');\n    const config = {};\n    s3_setup.detect(opts, config);\n    const s3 = s3_setup.get_s3(config);\n    const key_name = url.resolve(config.prefix, opts.package_name);\n    const s3_opts = {\n      Bucket: config.bucket,\n      Key: key_name\n    };\n    log.info('publish', 'Authenticating with s3');\n    log.info('publish', config);\n    log.info('publish', 'Checking for existing binary at ' + opts.hosted_path);\n    s3.headObject(s3_opts, (err, meta) => {\n      if (meta) log.info('publish', JSON.stringify(meta));\n\n      if (err && err.code === 'NotFound') {\n        // we are safe to publish because\n        // the object does not already exist\n        log.info('publish', 'Preparing to put object');\n        const s3_put_opts = {\n          ACL: 'public-read',\n          Body: fs.createReadStream(tarball),\n          Key: key_name,\n          Bucket: config.bucket\n        };\n        log.info('publish', 'Putting object', s3_put_opts.ACL, s3_put_opts.Bucket, s3_put_opts.Key);\n\n        try {\n          s3.putObject(s3_put_opts, (err2, resp) => {\n            log.info('publish', 'returned from putting object');\n\n            if (err2) {\n              log.info('publish', 's3 putObject error: \"' + err2 + '\"');\n              return callback(err2);\n            }\n\n            if (resp) log.info('publish', 's3 putObject response: \"' + JSON.stringify(resp) + '\"');\n            log.info('publish', 'successfully put object');\n            console.log('[' + package_json.name + '] published to ' + opts.hosted_path);\n            return callback();\n          });\n        } catch (err3) {\n          log.info('publish', 's3 putObject error: \"' + err3 + '\"');\n          return callback(err3);\n        }\n      } else if (err) {\n        log.info('publish', 's3 headObject error: \"' + err + '\"');\n        return callback(err);\n      } else {\n        log.error('publish', 'Cannot publish over existing version');\n        log.error('publish', \"Update the 'version' field in package.json and try again\");\n        log.error('publish', 'If the previous version was published in error see:');\n        log.error('publish', '\\t node-pre-gyp unpublish');\n        return callback(new Error('Failed publishing to ' + opts.hosted_path));\n      }\n    });\n  });\n}","map":{"version":3,"names":["module","exports","publish","usage","fs","require","path","log","versioning","napi","s3_setup","existsAsync","exists","url","gyp","argv","callback","package_json","napi_build_version","get_napi_build_version_from_command_args","opts","evaluate","tarball","staged_tarball","found","Error","info","config","detect","s3","get_s3","key_name","resolve","prefix","package_name","s3_opts","Bucket","bucket","Key","hosted_path","headObject","err","meta","JSON","stringify","code","s3_put_opts","ACL","Body","createReadStream","putObject","err2","resp","console","name","err3","error"],"sources":["/Users/aurele/Desktop/E-Commerce App/views/node_modules/@mapbox/node-pre-gyp/lib/publish.js"],"sourcesContent":["'use strict';\n\nmodule.exports = exports = publish;\n\nexports.usage = 'Publishes pre-built binary (requires aws-sdk)';\n\nconst fs = require('fs');\nconst path = require('path');\nconst log = require('npmlog');\nconst versioning = require('./util/versioning.js');\nconst napi = require('./util/napi.js');\nconst s3_setup = require('./util/s3_setup.js');\nconst existsAsync = fs.exists || path.exists;\nconst url = require('url');\n\nfunction publish(gyp, argv, callback) {\n  const package_json = gyp.package_json;\n  const napi_build_version = napi.get_napi_build_version_from_command_args(argv);\n  const opts = versioning.evaluate(package_json, gyp.opts, napi_build_version);\n  const tarball = opts.staged_tarball;\n  existsAsync(tarball, (found) => {\n    if (!found) {\n      return callback(new Error('Cannot publish because ' + tarball + ' missing: run `node-pre-gyp package` first'));\n    }\n\n    log.info('publish', 'Detecting s3 credentials');\n    const config = {};\n    s3_setup.detect(opts, config);\n    const s3 = s3_setup.get_s3(config);\n\n    const key_name = url.resolve(config.prefix, opts.package_name);\n    const s3_opts = {\n      Bucket: config.bucket,\n      Key: key_name\n    };\n    log.info('publish', 'Authenticating with s3');\n    log.info('publish', config);\n\n    log.info('publish', 'Checking for existing binary at ' + opts.hosted_path);\n    s3.headObject(s3_opts, (err, meta) => {\n      if (meta) log.info('publish', JSON.stringify(meta));\n      if (err && err.code === 'NotFound') {\n        // we are safe to publish because\n        // the object does not already exist\n        log.info('publish', 'Preparing to put object');\n        const s3_put_opts = {\n          ACL: 'public-read',\n          Body: fs.createReadStream(tarball),\n          Key: key_name,\n          Bucket: config.bucket\n        };\n        log.info('publish', 'Putting object', s3_put_opts.ACL, s3_put_opts.Bucket, s3_put_opts.Key);\n        try {\n          s3.putObject(s3_put_opts, (err2, resp) => {\n            log.info('publish', 'returned from putting object');\n            if (err2) {\n              log.info('publish', 's3 putObject error: \"' + err2 + '\"');\n              return callback(err2);\n            }\n            if (resp) log.info('publish', 's3 putObject response: \"' + JSON.stringify(resp) + '\"');\n            log.info('publish', 'successfully put object');\n            console.log('[' + package_json.name + '] published to ' + opts.hosted_path);\n            return callback();\n          });\n        } catch (err3) {\n          log.info('publish', 's3 putObject error: \"' + err3 + '\"');\n          return callback(err3);\n        }\n      } else if (err) {\n        log.info('publish', 's3 headObject error: \"' + err + '\"');\n        return callback(err);\n      } else {\n        log.error('publish', 'Cannot publish over existing version');\n        log.error('publish', \"Update the 'version' field in package.json and try again\");\n        log.error('publish', 'If the previous version was published in error see:');\n        log.error('publish', '\\t node-pre-gyp unpublish');\n        return callback(new Error('Failed publishing to ' + opts.hosted_path));\n      }\n    });\n  });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}